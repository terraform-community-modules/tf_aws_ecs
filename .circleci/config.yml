version: 2
jobs:
  build:
    machine: true
    working_directory: ~/my_app
    steps:
      - checkout
      - run:
          name: download terraform
          command: |
            wget https://releases.hashicorp.com/terraform/${tf_version}/terraform_${tf_version}_linux_amd64.zip -O /tmp/terraform.zip
            sudo unzip -d /usr/local/bin/ /tmp/terraform.zip
          environment:
            tf_version: 0.9.11

      # validate
      - run: make test

      # format
      - run: make fmt
